{% extends "html/base.html" %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/home.css' %}">

<button class="btn btn-primary m-3" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasExample" aria-controls="offcanvasExample">
    „É°„Éã„É•„Éº„ÇíÈñã„Åè
</button>
<!-- „Ç™„Éï„Ç≠„É£„É≥„Éê„Çπ„É°„Éã„É•„Éº -->
<div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasExample" aria-labelledby="offcanvasExampleLabel">
    <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="offcanvasExampleLabel">„É°„Éã„É•„Éº</h5>
        <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Èñâ„Åò„Çã"></button>
    </div>
    <div class="offcanvas-body">
        <h6>Ê§úÁ¥¢Êù°‰ª∂</h6>
        <ul>
            <!-- „Éï„É™„Éº„ÉØ„Éº„ÉâÊ§úÁ¥¢ -->
            {% if search_conditions.search %}
            <li>„Éï„É™„Éº„ÉØ„Éº„ÉâÊ§úÁ¥¢: 
                {% for keyword in search_conditions.search %}
                    <span>{{ keyword }}
                        <button class="btn btn-sm btn-danger remove-condition" data-type="search" data-value="{{ keyword }}">√ó</button>
                    </span>{% if not forloop.last %}, {% endif %}
                {% endfor %}
            </li>
            {% endif %}
            
            <!-- „Ç∏„É£„É≥„É´ -->
            {% if search_conditions.genre %}
                <li>„Ç∏„É£„É≥„É´: 
                    {% for genre in genres %}
                        {% if genre.id|stringformat:"s" in search_conditions.genre %}
                            <span>{{ genre.name }}
                                <button class="btn btn-sm btn-danger remove-condition" data-type="genre" data-value="{{ genre.id }}">√ó</button>

                            </span>
                        {% endif %}
                    {% endfor %}
                </li>
            {% endif %}

            <!-- „Çø„Ç∞ -->
            {% if search_conditions.tag %}
                <li>„Çø„Ç∞: 
                    {% for tag in tags %}
                        {% if tag.id|stringformat:"s" in search_conditions.tag %}
                            <span>{{ tag.name }}
                                <button class="btn btn-sm btn-danger remove-condition" data-type="tag" data-value="{{ tag.id }}">√ó</button>
                            </span>
                        {% endif %}
                    {% endfor %}
                </li>
            {% endif %}

            <!-- „Ç∑„Éº„Ç∫„É≥ -->
            {% if search_conditions.season %}
                <li>„Ç∑„Éº„Ç∫„É≥: 
                    {% for season in seasons %}
                        {% if season.id|stringformat:"s" in search_conditions.season %}
                            <span>{{ season.year }} Âπ¥ {{ season.get_season_display }}
                                <button class="btn btn-sm btn-danger remove-condition" data-type="season" data-value="{{ season.id }}">√ó</button>
                            </span>
                        {% endif %}
                    {% endfor %}
                </li>
            {% endif %}

            <!-- „Çπ„Çø„Ç∏„Ç™ -->
            {% if search_conditions.studio %}
                <li>„Çπ„Çø„Ç∏„Ç™: 
                    {% for studio in studios %}
                        {% if studio.id|stringformat:"s" in search_conditions.studio %}
                            <span>{{ studio.name }}
                                <button class="btn btn-sm btn-danger remove-condition" data-type="studio" data-value="{{ studio.id }}">√ó</button>
                            </span>
                        {% endif %}
                    {% endfor %}
                </li>
            {% endif %}
        </ul>

        <!-- „É™„Çª„ÉÉ„Éà„Éú„Çø„É≥ -->
        <div class="offcanvas-footer">
            <button class="btn btn-danger m-3" id="reset-search">Ê§úÁ¥¢„É™„Çª„ÉÉ„Éà</button>
        </div>
        
        <span>Ë©≥Á¥∞ÁîªÈù¢</span>
        <label class="switch">
            <input type="checkbox" id="toggle-detail">
            <span class="slider"></span>
        </label>

        <ul class="list-unstyled">
            

                <li>
                    <a href="#" class="text-decoration-none" data-bs-toggle="collapse" data-bs-target="#genreMenu" aria-expanded="false" aria-controls="genreMenu">üé≠ „Ç∏„É£„É≥„É´</a>
                    <div id="genreMenu" class="collapse">
                        {% for genre in genres %}
                            <button 
                                class="btn btn-outline-primary genre-button" 
                                data-type="genre" 
                                data-id="{{ genre.id }}">
                                {{ genre.name }}
                            </button>
                        {% endfor %}
                    </div>
                </li>

            

                <li>
                    <a href="#" class="text-decoration-none" data-bs-toggle="collapse" data-bs-target="#tagMenu" aria-expanded="false" aria-controls="tagMenu">üè∑ „Çø„Ç∞</a>
                    <div id="tagMenu" class="collapse">
                        {% for tag in tags %}
                            <button 
                                class="btn btn-outline-primary tag-button" 
                                data-type="tag" 
                                data-id="{{ tag.id }}">
                                {{ tag.name }}
                            </button>
                        {% endfor %}
                    </div>
                </li>

                
                <li>
                    <a href="#" class="text-decoration-none" data-bs-toggle="collapse" data-bs-target="#seasonMenu" aria-expanded="false" aria-controls="seasonMenu">üìÖ Âπ¥‰ª£</a>
                    <div id="seasonMenu" class="collapse">
                        <ul>
                            <!-- 2003Âπ¥ -->
                            <li>
                                <a href="#" class="text-decoration-none" data-bs-toggle="collapse" data-bs-target="#year-2003" aria-expanded="false" aria-controls="year-2003">
                                    2003Âπ¥
                                </a>
                                <div id="year-2003" class="collapse">
                                    <ul>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="1">ÂÜ¨</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="2">Êò•</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="3">Â§è</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="4">Áßã</button></li>
                                    </ul>
                                </div>
                            </li>
                            <!-- 2004Âπ¥ -->
                            <li>
                                <a href="#" class="text-decoration-none" data-bs-toggle="collapse" data-bs-target="#year-2004" aria-expanded="false" aria-controls="year-2004">
                                    2004Âπ¥
                                </a>
                                <div id="year-2004" class="collapse">
                                    <ul>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="5">ÂÜ¨</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="6">Êò•</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="7">Â§è</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="8">Áßã</button></li>
                                    </ul>
                                </div>
                            </li>
                            <!-- 2005Âπ¥ -->
                            <li>
                                <a href="#" class="text-decoration-none" data-bs-toggle="collapse" data-bs-target="#year-2005" aria-expanded="false" aria-controls="year-2005">
                                    2005Âπ¥
                                </a>
                                <div id="year-2005" class="collapse">
                                    <ul>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="9">ÂÜ¨</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="10">Êò•</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="11">Â§è</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="12">Áßã</button></li>
                                    </ul>
                                </div>
                            </li>
                            <!-- 2006Âπ¥ -->
                            <li>
                                <a href="#" class="text-decoration-none" data-bs-toggle="collapse" data-bs-target="#year-2006" aria-expanded="false" aria-controls="year-2006">
                                    2006Âπ¥
                                </a>
                                <div id="year-2006" class="collapse">
                                    <ul>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="13">ÂÜ¨</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="14">Êò•</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="15">Â§è</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="16">Áßã</button></li>
                                    </ul>
                                </div>
                            </li>
                            
                            <!-- 2007Âπ¥ -->
                            <li>
                                <a href="#" class="text-decoration-none" data-bs-toggle="collapse" data-bs-target="#year-2007" aria-expanded="false" aria-controls="year-2007">
                                    2007Âπ¥
                                </a>
                                <div id="year-2007" class="collapse">
                                    <ul>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="17">ÂÜ¨</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="18">Êò•</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="19">Â§è</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="20">Áßã</button></li>
                                    </ul>
                                </div>
                            </li>
                            <!-- 2008Âπ¥ -->
                            <li>
                                <a href="#" class="text-decoration-none" data-bs-toggle="collapse" data-bs-target="#year-2008" aria-expanded="false" aria-controls="year-2008">
                                    2008Âπ¥
                                </a>
                                <div id="year-2008" class="collapse">
                                    <ul>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="21">ÂÜ¨</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="22">Êò•</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="23">Â§è</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="24">Áßã</button></li>
                                    </ul>
                                </div>
                            </li>
                            <!-- 2009Âπ¥ -->
                            <li>
                                <a href="#" class="text-decoration-none" data-bs-toggle="collapse" data-bs-target="#year-2009" aria-expanded="false" aria-controls="year-2009">
                                    2009Âπ¥
                                </a>
                                <div id="year-2009" class="collapse">
                                    <ul>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="25">ÂÜ¨</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="26">Êò•</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="27">Â§è</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="28">Áßã</button></li>
                                    </ul>
                                </div>
                            </li>
                            <!-- 2010Âπ¥ -->
                            <li>
                                <a href="#" class="text-decoration-none" data-bs-toggle="collapse" data-bs-target="#year-2010" aria-expanded="false" aria-controls="year-2010">
                                    2010Âπ¥
                                </a>
                                <div id="year-2010" class="collapse">
                                    <ul>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="29">ÂÜ¨</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="30">Êò•</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="31">Â§è</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="32">Áßã</button></li>
                                    </ul>
                                </div>
                            </li>
                            <!-- 2011Âπ¥ -->
                            <li>
                                <a href="#" class="text-decoration-none" data-bs-toggle="collapse" data-bs-target="#year-2011" aria-expanded="false" aria-controls="year-2011">
                                    2011Âπ¥
                                </a>
                                <div id="year-2011" class="collapse">
                                    <ul>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="33">ÂÜ¨</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="34">Êò•</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="35">Â§è</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="36">Áßã</button></li>
                                    </ul>
                                </div>
                            </li>
                            <!-- 2012Âπ¥ -->
                            <li>
                                <a href="#" class="text-decoration-none" data-bs-toggle="collapse" data-bs-target="#year-2012" aria-expanded="false" aria-controls="year-2012">
                                    2012Âπ¥
                                </a>
                                <div id="year-2012" class="collapse">
                                    <ul>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="37">ÂÜ¨</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="38">Êò•</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="39">Â§è</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="40">Áßã</button></li>
                                    </ul>
                                </div>
                            </li>
                            <!-- 2013Âπ¥ -->
                            <li>
                                <a href="#" class="text-decoration-none" data-bs-toggle="collapse" data-bs-target="#year-2013" aria-expanded="false" aria-controls="year-2013">
                                    2013Âπ¥
                                </a>
                                <div id="year-2013" class="collapse">
                                    <ul>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="41">ÂÜ¨</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="42">Êò•</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="43">Â§è</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="44">Áßã</button></li>
                                    </ul>
                                </div>
                            </li>
                            <!-- 2014Âπ¥ -->
                            <li>
                                <a href="#" class="text-decoration-none" data-bs-toggle="collapse" data-bs-target="#year-2014" aria-expanded="false" aria-controls="year-2014">
                                    2014Âπ¥
                                </a>
                                <div id="year-2014" class="collapse">
                                    <ul>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="45">ÂÜ¨</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="46">Êò•</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="47">Â§è</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="48">Áßã</button></li>
                                    </ul>
                                </div>
                            </li>
                            <!-- 2015Âπ¥ -->
                            <li>
                                <a href="#" class="text-decoration-none" data-bs-toggle="collapse" data-bs-target="#year-2015" aria-expanded="false" aria-controls="year-2015">
                                    2015Âπ¥
                                </a>
                                <div id="year-2015" class="collapse">
                                    <ul>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="49">ÂÜ¨</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="50">Êò•</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="51">Â§è</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="52">Áßã</button></li>
                                    </ul>
                                </div>
                            </li>
                            <!-- 2016Âπ¥ -->
                            <li>
                                <a href="#" class="text-decoration-none" data-bs-toggle="collapse" data-bs-target="#year-2016" aria-expanded="false" aria-controls="year-2016">
                                    2016Âπ¥
                                </a>
                                <div id="year-2016" class="collapse">
                                    <ul>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="53">ÂÜ¨</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="54">Êò•</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="55">Â§è</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="56">Áßã</button></li>
                                    </ul>
                                </div>
                            </li>
                            <!-- 2017Âπ¥ -->
                            <li>
                                <a href="#" class="text-decoration-none" data-bs-toggle="collapse" data-bs-target="#year-2017" aria-expanded="false" aria-controls="year-2017">
                                    2017Âπ¥
                                </a>
                                <div id="year-2017" class="collapse">
                                    <ul>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="57">ÂÜ¨</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="58">Êò•</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="59">Â§è</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="60">Áßã</button></li>
                                    </ul>
                                </div>
                            </li>
                            <!-- 2018Âπ¥ -->
                            <li>
                                <a href="#" class="text-decoration-none" data-bs-toggle="collapse" data-bs-target="#year-2018" aria-expanded="false" aria-controls="year-2018">
                                    2018Âπ¥
                                </a>
                                <div id="year-2018" class="collapse">
                                    <ul>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="61">ÂÜ¨</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="62">Êò•</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="63">Â§è</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="64">Áßã</button></li>
                                    </ul>
                                </div>
                            </li>
                            <!-- 2019Âπ¥ -->
                            <li>
                                <a href="#" class="text-decoration-none" data-bs-toggle="collapse" data-bs-target="#year-2019" aria-expanded="false" aria-controls="year-2019">
                                    2019Âπ¥
                                </a>
                                <div id="year-2019" class="collapse">
                                    <ul>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="65">ÂÜ¨</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="66">Êò•</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="67">Â§è</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="68">Áßã</button></li>
                                    </ul>
                                </div>
                            </li>
                            <!-- 2020Âπ¥ -->
                            <li>
                                <a href="#" class="text-decoration-none" data-bs-toggle="collapse" data-bs-target="#year-2020" aria-expanded="false" aria-controls="year-2020">
                                    2020Âπ¥
                                </a>
                                <div id="year-2020" class="collapse">
                                    <ul>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="69">ÂÜ¨</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="70">Êò•</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="71">Â§è</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="72">Áßã</button></li>
                                    </ul>
                                </div>
                            </li>
                            <!-- 2021Âπ¥ -->
                            <li>
                                <a href="#" class="text-decoration-none" data-bs-toggle="collapse" data-bs-target="#year-2021" aria-expanded="false" aria-controls="year-2021">
                                    2021Âπ¥
                                </a>
                                <div id="year-2021" class="collapse">
                                    <ul>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="73">ÂÜ¨</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="74">Êò•</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="75">Â§è</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="76">Áßã</button></li>
                                    </ul>
                                </div>
                            </li>
                            <!-- 2022Âπ¥ -->
                            <li>
                                <a href="#" class="text-decoration-none" data-bs-toggle="collapse" data-bs-target="#year-2022" aria-expanded="false" aria-controls="year-2022">
                                    2022Âπ¥
                                </a>
                                <div id="year-2022" class="collapse">
                                    <ul>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="77">ÂÜ¨</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="78">Êò•</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="79">Â§è</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="80">Áßã</button></li>
                                    </ul>
                                </div>
                            </li>
                            <!-- 2023Âπ¥ -->
                            <li>
                                <a href="#" class="text-decoration-none" data-bs-toggle="collapse" data-bs-target="#year-2023" aria-expanded="false" aria-controls="year-2023">
                                    2023Âπ¥
                                </a>
                                <div id="year-2023" class="collapse">
                                    <ul>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="81">ÂÜ¨</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="82">Êò•</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="83">Â§è</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="84">Áßã</button></li>
                                    </ul>
                                </div>
                            </li>
                            <!-- 2024Âπ¥ -->
                            <li>
                                <a href="#" class="text-decoration-none" data-bs-toggle="collapse" data-bs-target="#year-2024" aria-expanded="false" aria-controls="year-2024">
                                    2024Âπ¥
                                </a>
                                <div id="year-2024" class="collapse">
                                    <ul>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="85">ÂÜ¨</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="86">Êò•</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season"data-id="87">Â§è</button></li>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="88">Áßã</button></li>
                                    </ul>
                                </div>
                            </li>
                            <!-- 2025Âπ¥ -->
                            <li>
                                <a href="#" class="text-decoration-none" data-bs-toggle="collapse" data-bs-target="#year-2025" aria-expanded="false" aria-controls="year-2025">
                                    2025Âπ¥
                                </a>
                                <div id="year-2025" class="collapse">
                                    <ul>
                                        <li><button class="btn btn-outline-primary season-button" data-type="season" data-id="89">ÂÜ¨</button></li>
                                    </ul>
                                </div>
                            </li>
                        </ul>
                    </div>





                
                
                
                
                
                
                
                
                
                
                
                

                
                
                <li>
                    <a href="#" class="text-decoration-none" data-bs-toggle="collapse" data-bs-target="#studioMenu" aria-expanded="false" aria-controls="studioMenu">üé¨ Âà∂‰Ωú„Çπ„Çø„Ç∏„Ç™</a>
                    <div id="studioMenu" class="collapse">
                        {% for studio in studios %}
                            <button 
                                class="btn btn-outline-primary studio-button" 
                                data-type="studio" 
                                data-id="{{ studio.id }}">
                                {{ studio.name }}
                            </button>
                        {% endfor %}
                    </div>
                </li>
        </ul>
    </div>
</div>

<h6>Ê§úÁ¥¢Êù°‰ª∂</h6>
<ul>
    <!-- „Éï„É™„Éº„ÉØ„Éº„ÉâÊ§úÁ¥¢ -->
    {% if search_conditions.search %}
    <li>„Éï„É™„Éº„ÉØ„Éº„ÉâÊ§úÁ¥¢: 
        {% for keyword in search_conditions.search %}
            <span>{{ keyword }}
            </span>{% if not forloop.last %}, {% endif %}
        {% endfor %}
    </li>
    {% endif %}
    
    <!-- „Ç∏„É£„É≥„É´ -->
    {% if search_conditions.genre %}
        <li>„Ç∏„É£„É≥„É´: 
            {% for genre in genres %}
                {% if genre.id|stringformat:"s" in search_conditions.genre %}
                    <span>{{ genre.name }}
                    </span>
                {% endif %}
            {% endfor %}
        </li>
    {% endif %}

    <!-- „Çø„Ç∞ -->
    {% if search_conditions.tag %}
        <li>„Çø„Ç∞: 
            {% for tag in tags %}
                {% if tag.id|stringformat:"s" in search_conditions.tag %}
                    <span>{{ tag.name }}
                    </span>
                {% endif %}
            {% endfor %}
        </li>
    {% endif %}

    <!-- „Ç∑„Éº„Ç∫„É≥ -->
    {% if search_conditions.season %}
        <li>„Ç∑„Éº„Ç∫„É≥: 
            {% for season in seasons %}
                {% if season.id|stringformat:"s" in search_conditions.season %}
                    <span>{{ season.year }} Âπ¥ {{ season.get_season_display }}
                    </span>
                {% endif %}
            {% endfor %}
        </li>
    {% endif %}

    <!-- „Çπ„Çø„Ç∏„Ç™ -->
    {% if search_conditions.studio %}
        <li>„Çπ„Çø„Ç∏„Ç™: 
            {% for studio in studios %}
                {% if studio.id|stringformat:"s" in search_conditions.studio %}
                    <span>{{ studio.name }}
                    </span>
                {% endif %}
            {% endfor %}
        </li>
    {% endif %}
</ul>

<div class="filters">
    <a href="{% url 'anime_tracker:home' %}?status=not_in_list" 
    class="btn btn-primary filter-btn {% if request.GET.status != 'watched' and request.GET.status != 'favorite' and request.GET.status != 'plan_to_watch' %}selected{% endif %}">
    ÂÖ®‰ΩúÂìÅ
    </a>
    
    {% if request.user.is_authenticated %}
        <a href="{% url 'anime_tracker:home' %}?status=watched" 
        class="btn btn-primary filter-btn {% if request.GET.status == 'watched' %}selected{% endif %}">
        Ë¶ñËÅ¥Ê∏à„Åø
        </a>
        <a href="{% url 'anime_tracker:home' %}?status=favorite" 
        class="btn btn-primary filter-btn {% if request.GET.status == 'favorite' %}selected{% endif %}">
        „ÅäÊ∞ó„Å´ÂÖ•„Çä
        </a>
        <a href="{% url 'anime_tracker:home' %}?status=plan_to_watch" 
        class="btn btn-primary filter-btn {% if request.GET.status == 'plan_to_watch' %}selected{% endif %}">
        Ë¶ñËÅ¥‰∫àÂÆö
        </a>
    {% else %}
        <!-- Êú™„É≠„Ç∞„Ç§„É≥ÊôÇ„ÅØ„Éú„Çø„É≥„ÇíÁÑ°ÂäπÂåñ -->
        <a class="btn btn-secondary disabled" aria-disabled="true" tabindex="-1">Ë¶ñËÅ¥Ê∏à„Åø</a>
        <a class="btn btn-secondary disabled" aria-disabled="true" tabindex="-1">„ÅäÊ∞ó„Å´ÂÖ•„Çä</a>
        <a class="btn btn-secondary disabled" aria-disabled="true" tabindex="-1">Ë¶ñËÅ¥‰∫àÂÆö</a>
    {% endif %}
</div>



<!-- „ÇΩ„Éº„Éà„Éú„Çø„É≥ -->
<div class="sort-options mb-3 d-flex justify-content-end">
    <label for="sort-select" class="form-label">‰∏¶„Å≥È†Ü:</label>
    <select id="sort-select" class="form-select" onchange="applySort()">
        <option value="season-desc" {% if request.GET.sort == 'season-desc' %}selected{% endif %}>„Ç∑„Éº„Ç∫„É≥ÔºàÊñ∞„Åó„ÅÑÈ†ÜÔºâ</option>
        <option value="season-asc" {% if request.GET.sort == 'season-asc' %}selected{% endif %}>„Ç∑„Éº„Ç∫„É≥ÔºàÂè§„ÅÑÈ†ÜÔºâ</option>
        <option value="average_rating" {% if request.GET.sort == 'average_rating' %}selected{% endif %}>‰∫∫Ê∞óÈ†Ü</option>
        <option value="watched_count-desc" {% if request.GET.sort == 'watched_count-desc' %}selected{% endif %}>ÁôªÈå≤Êï∞È†Ü</option>
    </select>
</div>

<div class="search-results">
    <div class="anime-list">
        {% for anime in page_obj %}
            <div class="anime-item">
                <a href="{% url 'anime_tracker:anime_detail' anime.id %}">
                    {% if anime.thumbnail %}
                        <img src="{{ anime.thumbnail.url }}" alt="{{ anime.title }}" width="150">
                    {% else %}
                        <p>ÁîªÂÉè„Å™„Åó</p>
                    {% endif %}
                    <p>{{ anime.title }}</p>
                </a>

                <div class="anime-detail" style="display: none;">
                    <p><strong>ÊîæÈÄÅÈñãÂßãÊó•:</strong> {{ anime.start_date }}</p>
                    {% if anime.end_date %}
                        <p><strong>ÊîæÈÄÅÁµÇ‰∫ÜÊó•:</strong> {{ anime.end_date }}</p>
                    {% endif %}
                    {% if anime.episode_count > 0 %}
                        <p><strong>Á∑èË©±Êï∞:</strong> {{ anime.episode_count }}</p>
                    {% endif %}
                    <p><strong>Âπ≥ÂùáË©ï‰æ°:</strong> {{ anime.average_rating }}</p>
                    <p><strong>ÁôªÈå≤ËÄÖÊï∞:</strong> {{ anime.watched_count }}</p>
                    <p><strong>„ÅäÊ∞ó„Å´ÂÖ•„ÇäÊï∞:</strong> {{ anime.favorite_count }}</p>
                </div>
            </div>
        {% empty %}
            <p>Ë©≤ÂΩì„Åô„Çã„Ç¢„Éã„É°„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</p>
        {% endfor %}
    </div>
    
    
    <!-- „Éö„Éº„Ç∏„Éç„Éº„Ç∑„Éß„É≥ -->
    <div class="pagination">
        <!-- ÊúÄÂàù„ÅÆ„Éö„Éº„Ç∏„Å∏„ÅÆ„É™„É≥„ÇØ -->
        {% if page_obj.has_previous %}
            <a href="?page=1" class="first-page">¬´</a>
            <a href="?page={{ page_obj.previous_page_number }}" class="prev-page">ÔºúÂâç„ÅÆ„Éö„Éº„Ç∏</a>
        {% endif %}
    
        <!-- „Éö„Éº„Ç∏Áï™Âè∑„ÅÆ„É´„Éº„Éó -->
        {% for num in page_obj.paginator.page_range %}
            {% if num == page_obj.number %}
                <span class="page-number active">{{ num }}</span> <!-- ÁèæÂú®„ÅÆ„Éö„Éº„Ç∏„ÅØÂº∑Ë™øË°®Á§∫ -->
            {% else %}
                <a href="?page={{ num }}" class="page-number">{{ num }}</a>
            {% endif %}
        {% endfor %}
    
        <!-- Ê¨°„ÅÆ„Éö„Éº„Ç∏„Å∏„ÅÆ„É™„É≥„ÇØ -->
        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}" class="next-page">Ê¨°„ÅÆ„Éö„Éº„Ç∏Ôºû</a>
            <a href="?page={{ page_obj.paginator.num_pages }}" class="last-page">¬ª</a>
        {% endif %}
    </div>
</div>


<script>
    // Ë©≥Á¥∞ÁîªÈù¢Áî®„ÅÆ„Éà„Ç∞„É´„Éú„Çø„É≥
    const detailToggleButton = document.getElementById("toggle-detail");
    const animeDetails = document.querySelectorAll('.anime-detail');
    console.log("AA")
    // Ë©≥Á¥∞ÊÉÖÂ†±„ÅÆË°®Á§∫/ÈùûË°®Á§∫
    detailToggleButton.addEventListener("change", function () {
        if (detailToggleButton.checked) {
            animeDetails.forEach(function(detail) {
                detail.style.display = 'block';  // Ë©≥Á¥∞„ÇíË°®Á§∫
                console.log("HEI")
            });
        } else {
            animeDetails.forEach(function(detail) {
                detail.style.display = 'none';  // Ë©≥Á¥∞„ÇíÈùûË°®Á§∫
            });
        }
    });

    // ÂàùÊúüÁä∂ÊÖã„ÅÆË®≠ÂÆöÔºà„Éà„Ç∞„É´„Éú„Çø„É≥„ÅÆÁä∂ÊÖã„Å´Âøú„Åò„Å¶Ë°®Á§∫/ÈùûË°®Á§∫Ôºâ
    if (detailToggleButton.checked) {
        animeDetails.forEach(function(detail) {
            console.log("Foo")
            detail.style.display = 'block';  // Ë©≥Á¥∞„ÇíË°®Á§∫
        });
    } else {
        animeDetails.forEach(function(detail) {
            detail.style.display = 'none';  // Ë©≥Á¥∞„ÇíÈùûË°®Á§∫
        });
    }
    
    document.addEventListener("DOMContentLoaded", function() {
        // ÂÖ®„Å¶„ÅÆ "remove-condition" „Éú„Çø„É≥„Å´„ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà„ÇíËøΩÂä†
        const buttons = document.querySelectorAll(".remove-condition");
        buttons.forEach(button => {
            button.addEventListener("click", function(event) {
                event.preventDefault(); // „Éá„Éï„Ç©„É´„Éà„ÅÆ„É™„É≥„ÇØÂãï‰Ωú„ÇíÈò≤„Åê
                
                // „Éú„Çø„É≥„Åã„ÇâÊù°‰ª∂„Çø„Ç§„Éó„Å®ÂÄ§„ÇíÂèñÂæó
                const type = this.getAttribute("data-type");
                const value = this.getAttribute("data-value");

                // ÁèæÂú®„ÅÆURL„ÇíÂèñÂæó„Åó„Å¶„ÇØ„Ç®„É™„Éë„É©„É°„Éº„Çø„ÇíÊìç‰Ωú
                const url = new URL(window.location.href);
                const params = url.searchParams;

                // Ë©≤ÂΩì„Åô„ÇãÊù°‰ª∂„ÇíÂâäÈô§
                const values = params.getAll(type); // „Åô„Åπ„Å¶„ÅÆÂÄ§„ÇíÂèñÂæó
                params.delete(type); // „Åæ„Åö„Åù„ÅÆ„Éë„É©„É°„Éº„Çø„ÇíÂâäÈô§
                values.forEach(val => {
                    if (val !== value) { // ÂâäÈô§ÂØæË±°‰ª•Â§ñ„ÇíÂÜçËøΩÂä†
                        params.append(type, val);
                    }
                });

                // Êñ∞„Åó„ÅÑURL„Å´„É™„ÉÄ„Ç§„É¨„ÇØ„Éà
                window.location.href = url.toString();
            });
        });
    });
    
    

    

</script>
{% endblock %}


