{% extends "html/base.html" %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/home.css' %}">

<button class="btn btn-primary m-3" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasExample" aria-controls="offcanvasExample">
    ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹ã
</button>
<!-- ã‚ªãƒ•ã‚­ãƒ£ãƒ³ãƒã‚¹ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
<div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasExample" aria-labelledby="offcanvasExampleLabel">
    <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="offcanvasExampleLabel">ãƒ¡ãƒ‹ãƒ¥ãƒ¼</h5>
        <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="é–‰ã˜ã‚‹"></button>
    </div>
    <div class="offcanvas-body">
        <h6>æ¤œç´¢æ¡ä»¶</h6>
        <ul>
            <!-- ãƒ•ãƒªãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢ -->
            {% if search_conditions.search %}
            <li>ãƒ•ãƒªãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢: 
                {% for keyword in search_conditions.search %}
                    <span>{{ keyword }}</span>{% if not forloop.last %}, {% endif %}
                {% endfor %}
            </li>
            {% endif %}
            
            <!-- ã‚¸ãƒ£ãƒ³ãƒ« -->
            {% if search_conditions.genre %}
                <li>ã‚¸ãƒ£ãƒ³ãƒ«: 
                    {% for genre in genres %}
                        {% if genre.id|stringformat:"s" in search_conditions.genre %}
                            <span>{{ genre.name }}</span>
                        {% endif %}
                    {% endfor %}
                </li>
            {% endif %}

            <!-- ã‚¿ã‚° -->
            {% if search_conditions.tag %}
                <li>ã‚¿ã‚°: 
                    {% for tag in tags %}
                        {% if tag.id|stringformat:"s" in search_conditions.tag %}
                            <span>{{ tag.name }}</span>
                        {% endif %}
                    {% endfor %}
                </li>
            {% endif %}

            <!-- ã‚·ãƒ¼ã‚ºãƒ³ -->
            {% if search_conditions.season %}
                <li>ã‚·ãƒ¼ã‚ºãƒ³: 
                    {% for season in seasons %}
                        {% if season.id|stringformat:"s" in search_conditions.season %}
                            <span>{{ season.year }} å¹´ {{ season.get_season_display }}</span>
                        {% endif %}
                    {% endfor %}
                </li>
            {% endif %}

            <!-- ã‚¹ã‚¿ã‚¸ã‚ª -->
            {% if search_conditions.studio %}
                <li>ã‚¹ã‚¿ã‚¸ã‚ª: 
                    {% for studio in studios %}
                        {% if studio.id|stringformat:"s" in search_conditions.studio %}
                            <span>{{ studio.name }}</span>
                        {% endif %}
                    {% endfor %}
                </li>
            {% endif %}
        </ul>

        <!-- ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ -->
        <div class="offcanvas-footer">
            <button class="btn btn-danger m-3" id="reset-search">æ¤œç´¢ãƒªã‚»ãƒƒãƒˆ</button>
        </div>

        <ul class="list-unstyled">
            <li><a href="#" class="text-decoration-none">ğŸ­ ã‚¸ãƒ£ãƒ³ãƒ«</a></li>
                <li>
                    {% for genre in genres %}
                        <button 
                            class="btn btn-outline-primary genre-button" 
                            data-type="genre" 
                            data-id="{{ genre.id }}">
                            {{ genre.name }}
                        </button>
                    {% endfor %}
                </li>
            <li><a href="#" class="text-decoration-none">ğŸ· ã‚¿ã‚°</a></li>
                <li>
                    {% for tag in tags %}
                        <button 
                            class="btn btn-outline-primary tag-button" 
                            data-type="tag" 
                            data-id="{{ tag.id }}">
                            {{ tag.name }}
                        </button>
                    {% endfor %}
                </li>
            <li><a href="#" class="text-decoration-none">ğŸ“… å¹´ä»£</a></li>
                <li>
                    {% for season in seasons %}
                        <button 
                            class="btn btn-outline-primary season-button" 
                            data-type="season" 
                            data-id="{{ season.id }}">
                            {{ season.year}} å¹´ {{season.get_season_display }}
                        </button>
                    {% endfor %}
                </li>
            <li><a href="#" class="text-decoration-none">ğŸ¬ åˆ¶ä½œã‚¹ã‚¿ã‚¸ã‚ª</a></li>
                <li>
                    {% for studio in studios %}
                        <button 
                            class="btn btn-outline-primary studio-button" 
                            data-type="studio" 
                            data-id="{{ studio.id }}">
                            {{ studio.name }}
                        </button>
                    {% endfor %}
                </li>
        </ul>
    </div>
</div>

<div class="filters">
    {% comment %} <a href="{% url 'anime_tracker:home' %}?status=not_in_list" 
    class="btn btn-primary filter-btn {% if request.GET.status == 'not_in_list' %}selected{% endif %}">
    å…¨ä½œå“
    </a> {% endcomment %}
    <a href="{% url 'anime_tracker:home' %}?status=not_in_list" 
    class="btn btn-primary filter-btn {% if request.GET.status != 'watched' and request.GET.status != 'favorite' and request.GET.status != 'plan_to_watch' %}selected{% endif %}">
    å…¨ä½œå“
    </a>
    
    {% if request.user.is_authenticated %}
        <a href="{% url 'anime_tracker:home' %}?status=watched" 
        class="btn btn-primary filter-btn {% if request.GET.status == 'watched' %}selected{% endif %}">
        è¦–è´æ¸ˆã¿
        </a>
        <a href="{% url 'anime_tracker:home' %}?status=favorite" 
        class="btn btn-primary filter-btn {% if request.GET.status == 'favorite' %}selected{% endif %}">
        ãŠæ°—ã«å…¥ã‚Š
        </a>
        <a href="{% url 'anime_tracker:home' %}?status=plan_to_watch" 
        class="btn btn-primary filter-btn {% if request.GET.status == 'plan_to_watch' %}selected{% endif %}">
        è¦–è´äºˆå®š
        </a>
    {% else %}
        <!-- æœªãƒ­ã‚°ã‚¤ãƒ³æ™‚ã¯ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ– -->
        <a class="btn btn-secondary disabled" aria-disabled="true" tabindex="-1">è¦–è´æ¸ˆã¿</a>
        <a class="btn btn-secondary disabled" aria-disabled="true" tabindex="-1">ãŠæ°—ã«å…¥ã‚Š</a>
        <a class="btn btn-secondary disabled" aria-disabled="true" tabindex="-1">è¦–è´äºˆå®š</a>
    {% endif %}
</div>



<!-- ã‚½ãƒ¼ãƒˆãƒœã‚¿ãƒ³ -->
<div class="sort-options mb-3 d-flex justify-content-end">
    <label for="sort-select" class="form-label">ä¸¦ã³é †:</label>
    <select id="sort-select" class="form-select" onchange="applySort()">
        <option value="season-desc" {% if request.GET.sort == 'season-desc' %}selected{% endif %}>ã‚·ãƒ¼ã‚ºãƒ³ï¼ˆæ–°ã—ã„é †ï¼‰</option>
        <option value="season-asc" {% if request.GET.sort == 'season-asc' %}selected{% endif %}>ã‚·ãƒ¼ã‚ºãƒ³ï¼ˆå¤ã„é †ï¼‰</option>
        <option value="average_rating" {% if request.GET.sort == 'average_rating' %}selected{% endif %}>äººæ°—é †</option>
        <option value="watched_count-desc" {% if request.GET.sort == 'watched_count-desc' %}selected{% endif %}>ç™»éŒ²æ•°é †</option>
    </select>
</div>

<div class="search-results">
    <div class="anime-list">
        {% for anime in animes %}
            <div class="anime-item">
                <a href="{% url 'anime_tracker:anime_detail' anime.id %}">
                    {% if anime.thumbnail %}
                        <img src="{{ anime.thumbnail.url }}" alt="{{ anime.title }}" width="150">
                    {% else %}
                        <p>ç”»åƒãªã—</p>
                    {% endif %}
                    <p>{{ anime.title }}</p>
                </a>
            </div>
        {% empty %}
            <p>è©²å½“ã™ã‚‹ã‚¢ãƒ‹ãƒ¡ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
        {% endfor %}
    </div>
</div>
{% endblock %}


